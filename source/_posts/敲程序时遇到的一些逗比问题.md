---
title: 敲程序时遇到的一些逗比问题
date: 2020-02-08 15:21:13
tags:
---
1、Kinect的深度图像尺寸和彩色图像尺寸是不一样的。有一次我直接获取了彩色图像的尺寸来处理深度图，结果遍历的时候总是出现段错误，而且错误的坐标还经常不一样。弄得我一脸纠结，后来发现实际上深度图像的尺寸远小于彩色图像，所以需要单独获取深度图的大小，不能够偷懒。为什么错误的坐标经常会不一样呢，因为数组越界实际上不一定不能访问，访问了也不一定没有值，因为有可能那个地址正好给了其他变量，这个可能性是很大的，所以这种时候是可以访问的，但是当你访问了一个彻底没有定义过的地址的时候，就会报错。

2、我用的freenet2这个库来读取的kinect的数据，开始用百度上查的16ushort类型接受的，后来发现深度图噪声非常的大，远远不像kinect的水平，而且设置低位比高位还准一点，这就说明肯定是读错了。后来阅读了freenet2的原码发现了他定义的是float类型，所以我就改成了32FC来读取，最后就正确了。

3、我在观察二值图的时候发现了存在第三种颜色，甚至四种五种，各种灰色。弄得我打印了所有像素值，发现只有两种，可明明显示的就有灰色，最后意外的发现debian下的imshow是可以通过滚鼠标放大的，放大后才发现黑白混合在一起的时候会出现灰色，根据比例会出现不同的灰色，这个灰只是远看才是，放大了就能看清黑点和白点了。  

4、我用freenet2.getXYZRGBData读取点云数据，读取的总是不对，无法顺利的生成点云图片。经过仔细排查发现从kinect读出来的rgb图和深度图都不能改变。而我对深度图做了裁剪。但是裁剪的是另一个opencv的mat变量，我没有发现，因为它是直接用的mat等于方式赋值的，所以相当于内存映射，数据对应的是同一块内存。所以我虽然裁剪的是其他变量，但是对这个数据造成了影响。这个问题很隐晦，如果对opencv或者指针不太了解的人很难发现。所以最后我把mat的等号赋值改成了copyTo这个函数，问题就解决了。这里再次强调了即便是用别人的库也要对原理了解清楚，否则就会出现很多无法解释的问题。

  

5、这个是同事遇到的问题，但是问我的时候我也没有马上想出来。同事用一个int的变量去接收另一个变量的值，就是简简单单的int a=b;的程序，但是a 和
b都不一样。b是0.6而a是0。我们一直以为是没有赋值成功。纠结了很久才发现原来是int类型接受浮点的值，造成了省略整数位。而正好这个数字又是<1的，所以结果正好是0，和没赋值成功一样，弄得我们纠结了很久。要是大一点应该能一下子就看出来是省略了整数位的。

  

6、最近跑程序某一个函数结束的时候经常会出现段错误，segmentation
fault。经过检查发现是忘记最后return了，然而外面又打印了它的返回值。汗死。

